<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Gestion Assurance Construction - SMA DWH</title>
    <link rel="stylesheet" href="/static/styles.css?v=3">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1><i class="fas fa-building"></i> SMA DWH</h1>
                <p class="subtitle">Gestion Assurance Construction</p>
            </div>
            
            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" data-view="dashboard">
                    <i class="fas fa-dashboard"></i>
                    <span>Tableau de bord</span>
                </a>
                <a href="#" class="nav-item" data-view="clients">
                    <i class="fas fa-users"></i>
                    <span>Clients</span>
                </a>
                <a href="#" class="nav-item" data-view="addresses">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>Adresses</span>
                </a>
                <a href="#" class="nav-item" data-view="sites">
                    <i class="fas fa-hard-hat"></i>
                    <span>Chantiers</span>
                </a>
                <a href="#" class="nav-item" data-view="contracts">
                    <i class="fas fa-file-contract"></i>
                    <span>Contrats</span>
                </a>
                <a href="#" class="nav-item" data-view="history">
                    <i class="fas fa-history"></i>
                    <span>Historique</span>
                </a>
                <a href="#" class="nav-item" data-view="generate">
                    <i class="fas fa-magic"></i>
                    <span>Génération de données</span>
                </a>
                <a href="#" class="nav-item" data-view="referentials">
                    <i class="fas fa-database"></i>
                    <span>Référentiels</span>
                </a>
                <a href="/docs" class="nav-item" target="_blank">
                    <i class="fas fa-book"></i>
                    <span>Documentation API</span>
                    <i class="fas fa-external-link-alt" style="margin-left: auto; font-size: 0.8em; opacity: 0.6;"></i>
                </a>
            </nav>
            
            <div class="sidebar-footer">
                <div class="api-status">
                    <i class="fas fa-circle" id="api-status-icon"></i>
                    <span id="api-status-text">Vérification...</span>
                </div>
            </div>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Header -->
            <header class="content-header">
                <div class="header-left">
                    <h2 id="page-title">Tableau de bord</h2>
                    <p id="page-subtitle">Vue d'ensemble de la base de données</p>
                </div>
                <div class="header-right">
                    <div class="search-container">
                        <i class="fas fa-search"></i>
                        <input type="text" id="global-search" placeholder="Rechercher un client...">
                        <button id="phonetic-toggle" class="btn-icon" title="Recherche phonétique">
                            <i class="fas fa-microphone"></i>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Content Views -->
            <div class="content-body">
                <!-- Dashboard View -->
                <div id="dashboard-view" class="view active">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon bg-blue">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="stat-clients">0</h3>
                                <p>Clients</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon bg-green">
                                <i class="fas fa-map-marker-alt"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="stat-addresses">0</h3>
                                <p>Adresses</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon bg-orange">
                                <i class="fas fa-hard-hat"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="stat-sites">0</h3>
                                <p>Chantiers</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon bg-purple">
                                <i class="fas fa-file-contract"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="stat-contracts">0</h3>
                                <p>Contrats</p>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-grid">
                        <div class="dashboard-card">
                            <h3><i class="fas fa-chart-line"></i> Activité récente</h3>
                            <div id="recent-activity" class="activity-list"></div>
                        </div>
                        <div class="dashboard-card">
                            <h3><i class="fas fa-exclamation-triangle"></i> Alertes</h3>
                            <div id="alerts-list" class="alerts-list"></div>
                        </div>
                    </div>
                </div>

                <!-- Clients View -->
                <div id="clients-view" class="view">
                    <div class="view-toolbar">
                        <button class="btn btn-primary" onclick="showClientModal()">
                            <i class="fas fa-plus"></i> Nouveau client
                        </button>
                        <div class="toolbar-filters">
                            <select id="client-type-filter">
                                <option value="">Tous les types</option>
                                <option value="particulier">Particulier</option>
                                <option value="professionnel">Professionnel</option>
                            </select>
                            <input type="text" id="client-search" placeholder="Rechercher...">
                        </div>
                    </div>
                    <div id="clients-table-container"></div>
                </div>

                <!-- Addresses View -->
                <div id="addresses-view" class="view">
                    <div class="view-toolbar">
                        <button class="btn btn-primary" onclick="showAddressModal()">
                            <i class="fas fa-plus"></i> Nouvelle adresse
                        </button>
                    </div>
                    <div id="addresses-table-container"></div>
                </div>

                <!-- Sites View -->
                <div id="sites-view" class="view">
                    <div class="view-toolbar">
                        <button class="btn btn-primary" onclick="showSiteModal()">
                            <i class="fas fa-plus"></i> Nouveau chantier
                        </button>
                    </div>
                    <div id="sites-table-container"></div>
                </div>

                <!-- Contracts View -->
                <div id="contracts-view" class="view">
                    <div class="view-toolbar">
                        <button class="btn btn-primary" onclick="showContractModal()">
                            <i class="fas fa-plus"></i> Nouveau contrat
                        </button>
                        <div class="toolbar-filters">
                            <select id="contract-status-filter">
                                <option value="">Tous les statuts</option>
                                <option value="brouillon">Brouillon</option>
                                <option value="en_attente">En attente</option>
                                <option value="actif">Actif</option>
                                <option value="expire">Expiré</option>
                                <option value="resilie">Résilié</option>
                            </select>
                        </div>
                    </div>
                    <div id="contracts-table-container"></div>
                </div>

                <!-- History View -->
                <div id="history-view" class="view">
                    <div class="view-toolbar">
                        <div class="toolbar-filters">
                            <select id="history-action-filter">
                                <option value="">Toutes les actions</option>
                                <option value="creation">Création</option>
                                <option value="modification">Modification</option>
                                <option value="changement_statut">Changement statut</option>
                                <option value="renouvellement">Renouvellement</option>
                                <option value="resiliation">Résiliation</option>
                            </select>
                            <input type="date" id="history-date-from" placeholder="Date début">
                            <input type="date" id="history-date-to" placeholder="Date fin">
                        </div>
                    </div>
                    <div id="history-table-container"></div>
                </div>

                <!-- Generate View -->
                <div id="generate-view" class="view">
                    <div class="generate-container">
                        <div class="generate-card">
                            <h3><i class="fas fa-magic"></i> Génération de données de test</h3>
                            
                            <div class="form-group">
                                <label for="gen-count">Nombre de clients à générer</label>
                                <input type="number" id="gen-count" min="1" max="100" value="10">
                            </div>

                            <div class="form-group">
                                <label for="gen-type">Type de clients</label>
                                <select id="gen-type">
                                    <option value="mixte">Mixte (particuliers et entreprises)</option>
                                    <option value="particulier">Particuliers uniquement</option>
                                    <option value="entreprise">Entreprises uniquement</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="gen-clean" checked>
                                    Nettoyer les données existantes avant génération
                                </label>
                            </div>

                            <button class="btn btn-primary btn-large" onclick="generateData()">
                                <i class="fas fa-magic"></i> Générer les données
                            </button>

                            <div id="generate-progress" class="progress-container" style="display: none;">
                                <div class="progress-bar">
                                    <div class="progress-fill"></div>
                                </div>
                                <p class="progress-text">Génération en cours...</p>
                            </div>
                        </div>

                        <div class="generate-card danger-zone">
                            <h3><i class="fas fa-exclamation-triangle"></i> Zone dangereuse</h3>
                            
                            <div class="form-group">
                                <label>Supprimer toutes les données</label>
                                <p class="help-text">Cette action supprimera tous les clients et leurs données associées (adresses, chantiers, contrats, historique).</p>
                                <button class="btn btn-danger" onclick="deleteAllData()">
                                    <i class="fas fa-trash"></i> Supprimer toutes les données
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Referentials View -->
                <div id="referentials-view" class="view">
                    <div class="referentials-grid">
                        <div class="ref-card" data-ref="contract_types">
                            <h3><i class="fas fa-file-contract"></i> Types de contrats</h3>
                            <p class="ref-count">0 types</p>
                            <button class="btn btn-sm" onclick="loadReferential('contract_types')">Voir</button>
                        </div>
                        <div class="ref-card" data-ref="guarantee_types">
                            <h3><i class="fas fa-shield-alt"></i> Garanties</h3>
                            <p class="ref-count">0 garanties</p>
                            <button class="btn btn-sm" onclick="loadReferential('guarantee_types')">Voir</button>
                        </div>
                        <div class="ref-card" data-ref="clauses">
                            <h3><i class="fas fa-file-alt"></i> Clauses</h3>
                            <p class="ref-count">0 clauses</p>
                            <button class="btn btn-sm" onclick="loadReferential('clauses')">Voir</button>
                        </div>
                        <div class="ref-card" data-ref="building_categories">
                            <h3><i class="fas fa-building"></i> Catégories de bâtiments</h3>
                            <p class="ref-count">0 catégories</p>
                            <button class="btn btn-sm" onclick="loadReferential('building_categories')">Voir</button>
                        </div>
                        <div class="ref-card" data-ref="work_categories">
                            <h3><i class="fas fa-tools"></i> Catégories de travaux</h3>
                            <p class="ref-count">0 catégories</p>
                            <button class="btn btn-sm" onclick="loadReferential('work_categories')">Voir</button>
                        </div>
                        <div class="ref-card" data-ref="professions">
                            <h3><i class="fas fa-user-tie"></i> Professions</h3>
                            <p class="ref-count">0 professions</p>
                            <button class="btn btn-sm" onclick="loadReferential('professions')">Voir</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal Template -->
    <div id="modal-overlay" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modal-title">Modal Title</h3>
                <button class="modal-close" onclick="closeModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Dynamic content -->
            </div>
            <div class="modal-footer" id="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">Annuler</button>
                <button class="btn btn-primary" id="modal-action">Enregistrer</button>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container"></div>

    <script src="/static/api.js?v=5"></script>
    <script src="/static/phonetic.js?v=5"></script>
    <script src="/static/app.js?v=5"></script>
</body>
</html>
